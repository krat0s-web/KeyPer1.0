{% extends "maison_app/dashboard_base.html" %}
{% load static %}
{% block page_title %}{{ piece.nom }}{% endblock %}
{% block page_heading %}{{ piece.nom }}{% endblock %}

{% block breadcrumb %}
<ul class="breadcrumb">
    <li><a href="{% url 'dashboard' %}">Dashboard</a></li>
    /
    <li><a href="{% url 'liste_foyers' %}">Foyers</a></li>
    /
    <li><a href="{% url 'detail_foyer' piece.id_foyer.id %}">{{ piece.id_foyer.nom }}</a></li>
    /
    <li><a href="#" class="active">{{ piece.nom }}</a></li>
</ul>
{% endblock %}

{% block page_content %}
<div class="card-dashboard mb-4">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 16px;">
        <h3 style="margin: 0; color: var(--dark); display: flex; align-items: center; gap: 12px;">
            {% if piece.type_piece == 'cuisine' %}
                <i class='bx bx-dish' style="font-size: 28px; color: var(--primary);"></i>
            {% elif piece.type_piece == 'chambre' %}
                <i class='bx bx-bed' style="font-size: 28px; color: var(--primary);"></i>
            {% elif piece.type_piece == 'toilettes' %}
                <i class='bx bx-toilet' style="font-size: 28px; color: var(--primary);"></i>
            {% elif piece.type_piece == 'salle_de_bain' %}
                <i class='bx bx-shower' style="font-size: 28px; color: var(--primary);"></i>
            {% elif piece.type_piece == 'salle_de_jeux' %}
                <i class='bx bx-game' style="font-size: 28px; color: var(--primary);"></i>
            {% elif piece.type_piece == 'salon' %}
                <i class='bx bx-couch' style="font-size: 28px; color: var(--primary);"></i>
            {% elif piece.type_piece == 'buanderie' %}
                <i class='bx bx-washing-machine' style="font-size: 28px; color: var(--primary);"></i>
            {% elif piece.type_piece == 'garage' %}
                <i class='bx bx-car' style="font-size: 28px; color: var(--primary);"></i>
            {% elif piece.type_piece == 'jardin' %}
                <i class='bx bx-tree' style="font-size: 28px; color: var(--primary);"></i>
            {% elif piece.type_piece == 'salle_a_manger' %}
                <i class='bx bx-dining-table' style="font-size: 28px; color: var(--primary);"></i>
            {% elif piece.type_piece == 'bureau' %}
                <i class='bx bx-desktop' style="font-size: 28px; color: var(--primary);"></i>
            {% else %}
                <i class='bx bx-door-open' style="font-size: 28px; color: var(--primary);"></i>
            {% endif %}
            {{ piece.nom }}
        </h3>
        <a href="{% url 'detail_foyer' piece.id_foyer.id %}" style="padding: 8px 16px; background: var(--grey); color: var(--dark); border-radius: 8px; text-decoration: none; display: flex; align-items: center; gap: 8px; transition: all 0.3s ease;">
            <i class='bx bx-arrow-back'></i>Retour au foyer
        </a>
    </div>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px;">
        <!-- Informations -->
        <div class="card-dashboard" style="border-left: 4px solid var(--primary);">
            <h5 style="margin: 0 0 16px 0; color: var(--dark);">Informations</h5>
            {% if piece.photo %}
            <img src="{{ piece.photo.url }}" alt="{{ piece.nom }}" style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px; margin-bottom: 16px;">
            {% endif %}
            {% if piece.description %}
            <p style="color: var(--dark-grey); margin: 0 0 12px 0;">{{ piece.description }}</p>
            {% endif %}
            <div style="margin-bottom: 8px;">
                <strong style="color: var(--dark);">Type :</strong> 
                <span style="color: var(--dark-grey);">{{ piece.get_type_display_name }}</span>
            </div>
            <div style="margin-bottom: 8px;">
                <strong style="color: var(--dark);">Tâches :</strong> 
                <span style="padding: 4px 8px; background: var(--light-primary); color: var(--primary); border-radius: 12px; font-size: 12px; margin-right: 4px;">{{ taches_actives.count }} actives</span>
                <span style="padding: 4px 8px; background: var(--light-success); color: var(--success); border-radius: 12px; font-size: 12px;">{{ taches_terminees.count }} terminées</span>
            </div>
            {% if animaux %}
            <div>
                <strong style="color: var(--dark);">Animaux :</strong>
                <div style="display: flex; gap: 4px; flex-wrap: wrap; margin-top: 4px;">
                    {% for animal in animaux %}
                    <span style="padding: 4px 8px; background: var(--grey); color: var(--dark); border-radius: 12px; font-size: 12px;">{{ animal.nom }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            {% if piece.type_piece == 'salle_de_jeux' %}
            <div style="margin-top: 16px;">
                <a href="{% url 'liste_niveaux_snake' piece.id %}" style="width: 100%; padding: 12px; background: var(--warning); color: var(--dark); border-radius: 8px; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.3s ease; font-weight: 500;">
                    <i class='bx bx-game'></i>Jouer au Snake
                </a>
            </div>
            {% endif %}
        </div>
        
        <!-- Tâches Actives -->
        <div class="card-dashboard" style="border-left: 4px solid var(--warning);">
            <h5 style="margin: 0 0 16px 0; color: var(--dark); display: flex; align-items: center; gap: 8px;">
                <i class='bx bx-list-ul' style="color: var(--warning);"></i>Tâches Actives ({{ taches_actives.count }})
            </h5>
            {% if taches_actives %}
            <div style="display: flex; flex-direction: column; gap: 12px;">
                {% for tache in taches_actives %}
                <div class="card-dashboard" style="border-left: 4px solid {% if tache.priorite == 'Haute' %}var(--danger){% elif tache.priorite == 'Moyenne' %}var(--warning){% else %}var(--primary){% endif %}; padding: 12px;">
                    <h6 style="margin: 0 0 8px 0; color: var(--dark);">{{ tache.titre }}</h6>
                    {% if tache.date_limite %}
                    <small style="color: var(--dark-grey); display: flex; align-items: center; gap: 4px; margin-bottom: 8px;">
                        <i class='bx bx-calendar-check'></i>{{ tache.date_limite|date:"d/m/Y" }}
                    </small>
                    {% endif %}
                    <a href="{% url 'detail_tache' tache.id %}" style="padding: 6px 12px; background: var(--primary); color: var(--light); border-radius: 6px; text-decoration: none; display: inline-flex; align-items: center; gap: 4px; font-size: 14px;">
                        <i class='bx bx-show'></i>Voir
                    </a>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p style="text-align: center; color: var(--dark-grey); padding: 24px; margin: 0;">Aucune tâche active pour cette pièce.</p>
            {% endif %}
        </div>
        
        <!-- Tâches Terminées -->
        {% if taches_terminees %}
        <div class="card-dashboard" style="border-left: 4px solid var(--success);">
            <h5 style="margin: 0 0 16px 0; color: var(--dark); display: flex; align-items: center; gap: 8px;">
                <i class='bx bx-check-circle' style="color: var(--success);"></i>Tâches Terminées ({{ taches_terminees.count }})
            </h5>
            <div style="display: flex; flex-direction: column; gap: 12px;">
                {% for tache in taches_terminees %}
                <div class="card-dashboard" style="border-left: 4px solid var(--success); padding: 12px; opacity: 0.85;">
                    <h6 style="margin: 0 0 8px 0; color: var(--dark);">{{ tache.titre }}</h6>
                    {% if tache.complete_par %}
                    <small style="color: var(--dark-grey); display: flex; align-items: center; gap: 4px; margin-bottom: 8px;">
                        <i class='bx bx-user-check'></i>Par {{ tache.complete_par.nom|default:tache.complete_par.email }}
                    </small>
                    {% endif %}
                    <a href="{% url 'detail_tache' tache.id %}" style="padding: 6px 12px; background: var(--primary); color: var(--light); border-radius: 6px; text-decoration: none; display: inline-flex; align-items: center; gap: 4px; font-size: 14px;">
                        <i class='bx bx-show'></i>Voir
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
