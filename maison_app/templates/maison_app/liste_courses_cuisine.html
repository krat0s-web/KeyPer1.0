{% extends "maison_app/dashboard_base.html" %}
{% load static %}
{% block title %}Listes de Courses - {{ piece.nom }}{% endblock %}
{% block page_title %}Listes de Courses - {{ piece.nom }}{% endblock %}
{% block page_heading %}Listes de Courses{% endblock %}

{% block breadcrumb %}
<ul class="breadcrumb">
    <li><a href="{% url 'dashboard' %}">Dashboard</a></li>
    /
    <li><a href="{% url 'liste_foyers' %}">Foyers</a></li>
    /
    <li><a href="{% url 'detail_foyer' piece.id_foyer.id %}">{{ piece.id_foyer.nom }}</a></li>
    /
    <li><a href="{% url 'cuisine_view' piece.id %}">Cuisine</a></li>
    /
    <li><a href="#" class="active">Listes de Courses</a></li>
</ul>
{% endblock %}

{% block page_content %}
<div class="card-dashboard mb-4">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 12px;">
        <h3 style="color: var(--dark); display: flex; align-items: center; gap: 12px;">
            <i class='bx bx-cart' style="font-size: 28px; color: var(--success);"></i>Listes de Courses
        </h3>
        <a href="{% url 'cuisine_view' piece.id %}" style="padding: 8px 16px; background: var(--grey); color: var(--dark); border-radius: 8px; display: flex; align-items: center; gap: 8px; text-decoration: none; transition: all 0.3s ease;">
            <i class='bx bx-arrow-back'></i>Retour
        </a>
    </div>
    
    <!-- Créer une nouvelle liste -->
    {% if user.role != 'observateur' %}
    <div style="margin-bottom: 32px;">
        <h5 style="margin-bottom: 16px; color: var(--dark); display: flex; align-items: center; gap: 8px;">
            <i class='bx bx-plus-circle' style="font-size: 20px; color: var(--success);"></i>Créer une nouvelle liste
        </h5>
        <form method="post" style="display: flex; gap: 12px; flex-wrap: wrap;">
            {% csrf_token %}
            <input type="hidden" name="action" value="creer_liste">
            <input type="text" name="nom_liste" placeholder="Ex: Courses du week-end" required
                   style="flex: 1; min-width: 200px; padding: 12px 16px; border: 1px solid var(--grey); border-radius: 8px; background: var(--light); color: var(--dark); outline: none;">
            <button type="submit" style="padding: 12px 24px; background: var(--success); color: var(--light); border: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.3s ease;">
                <i class='bx bx-plus-circle'></i>Créer
            </button>
        </form>
    </div>
    {% else %}
    <div style="background: var(--light-warning); color: var(--dark); padding: 16px; border-radius: 8px; margin-bottom: 32px; text-align: center; border-left: 4px solid var(--warning);">
        <i class='bx bx-info-circle' style="font-size: 20px; margin-right: 8px;"></i> Mode observateur : Accès en lecture seule. Vous ne pouvez pas créer de listes de courses.
    </div>
    {% endif %}

    <hr style="border: none; border-top: 1px solid var(--grey); margin: 24px 0;">

    <!-- Listes existantes -->
    <h5 style="margin-bottom: 16px; color: var(--dark); display: flex; align-items: center; gap: 8px;">
        <i class='bx bx-list-ul' style="font-size: 20px; color: var(--primary);"></i>Listes existantes
    </h5>
    {% if listes_courses %}
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px;">
        {% for liste in listes_courses %}
        <div style="background: var(--light); padding: 20px; border-radius: 12px; border-left: 4px solid {% if liste.statut == 'Acheté' %}var(--success){% else %}var(--warning){% endif %}; transition: all 0.3s ease;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow='none'">
            <h6 style="margin: 0 0 8px 0; color: var(--dark);">{{ liste.nom }}</h6>
            <p style="color: var(--dark-grey); font-size: 12px; margin: 0 0 12px 0;">
                Créée le {{ liste.date_creation|date:"d/m/Y H:i" }}
            </p>
            <span style="padding: 4px 12px; background: {% if liste.statut == 'Acheté' %}var(--success){% else %}var(--warning){% endif %}; color: {% if liste.statut == 'Acheté' %}var(--light){% else %}var(--dark){% endif %}; border-radius: 12px; font-size: 12px; display: inline-block; margin-bottom: 12px;">
                {{ liste.statut }}
            </span>
            <div style="display: flex; gap: 8px; margin-top: 12px;">
                <a href="{% url 'detail_liste_courses' piece.id liste.id %}" style="padding: 6px 12px; background: var(--primary); color: var(--light); border-radius: 8px; text-decoration: none; display: flex; align-items: center; gap: 4px; font-size: 14px; transition: all 0.3s ease;">
                    <i class='bx bx-show'></i>Voir
                </a>
                {% if user.role != 'observateur' %}
                <form method="post" style="display: inline;" onsubmit="return confirm('Supprimer cette liste ?');">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="supprimer_liste">
                    <input type="hidden" name="liste_id" value="{{ liste.id }}">
                    <button type="submit" style="padding: 6px 12px; background: var(--danger); color: var(--light); border: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 4px; font-size: 14px;">
                        <i class='bx bx-trash'></i>
                    </button>
                </form>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div style="background: var(--light-primary); color: var(--primary); padding: 32px; border-radius: 12px; text-align: center;">
        <i class='bx bx-info-circle' style="font-size: 2rem; margin-bottom: 12px; display: block;"></i>
        Aucune liste de courses créée pour le moment.
    </div>
    {% endif %}
</div>
{% endblock %}
