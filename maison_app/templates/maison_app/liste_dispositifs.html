{% extends "maison_app/dashboard_base.html" %}
{% load static %}
{% block title %}Dispositifs IoT{% endblock %}
{% block page_title %}Dispositifs IoT{% endblock %}
{% block page_heading %}Dispositifs IoT{% endblock %}

{% block breadcrumb %}
<ul class="breadcrumb">
    <li><a href="{% url 'dashboard' %}">Dashboard</a></li>
    /
    <li><a href="{% url 'detail_foyer' foyer.id %}">Foyer</a></li>
    /
    <li><a href="#" class="active">Dispositifs</a></li>
</ul>
{% endblock %}

{% block page_content %}
<div class="card-dashboard mb-4">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 12px;">
        <h3 style="color: var(--dark); display: flex; align-items: center; gap: 12px;">
            <i class='bx bx-devices' style="font-size: 28px; color: var(--primary);"></i>Dispositifs IoT
        </h3>
        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
            {% if user.role == 'admin' %}
            <a href="{% url 'ajouter_dispositif' %}" style="padding: 8px 16px; background: var(--success); color: var(--light); border-radius: 8px; display: flex; align-items: center; gap: 8px; text-decoration: none; transition: all 0.3s ease;">
                <i class='bx bx-plus-circle'></i>Ajouter un dispositif
            </a>
            {% endif %}
            <a href="{% url 'historique_actions_dispositifs' %}" style="padding: 8px 16px; background: var(--info); color: var(--light); border-radius: 8px; display: flex; align-items: center; gap: 8px; text-decoration: none; transition: all 0.3s ease;">
                <i class='bx bx-history'></i>Historique
            </a>
        </div>
    </div>
    
    {% if dispositifs %}
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px;">
        {% for dispositif in dispositifs %}
        <div class="card-dashboard" style="border-left: 4px solid {% if dispositif.etat %}var(--success){% else %}var(--dark-grey){% endif %};">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
                <div style="flex: 1;">
                    <h4 style="margin: 0 0 8px 0; color: var(--dark); font-size: 18px; font-weight: 600;">
                        {{ dispositif.nom }}
                    </h4>
                    <p style="margin: 0; color: var(--dark-grey); font-size: 14px;">
                        <i class='bx bx-{{ dispositif.type|default:"device" }}'></i> {{ dispositif.get_type_display }}
                    </p>
                    {% if dispositif.id_piece %}
                    <p style="margin: 4px 0 0 0; color: var(--dark-grey); font-size: 12px;">
                        <i class='bx bx-home'></i> {{ dispositif.id_piece.nom }}
                    </p>
                    {% endif %}
                </div>
                <div style="padding: 8px 12px; background: {% if dispositif.etat %}var(--success){% else %}var(--dark-grey){% endif %}; color: var(--light); border-radius: 20px; font-size: 12px; font-weight: 500;">
                    {% if dispositif.etat %}ON{% else %}OFF{% endif %}
                </div>
            </div>
            
            {% if user.role == 'admin' %}
            <div style="display: flex; gap: 8px; margin-top: 16px;">
                <a href="{% url 'modifier_dispositif' dispositif.id %}" style="flex: 1; padding: 8px; background: var(--primary); color: var(--light); border-radius: 6px; text-decoration: none; text-align: center; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 4px;">
                    <i class='bx bx-edit'></i>Modifier
                </a>
                <a href="{% url 'supprimer_dispositif' dispositif.id %}" style="flex: 1; padding: 8px; background: var(--danger); color: var(--light); border-radius: 6px; text-decoration: none; text-align: center; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 4px;">
                    <i class='bx bx-trash'></i>Supprimer
                </a>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div style="text-align: center; padding: 48px; color: var(--dark-grey);">
        <i class='bx bx-devices' style="font-size: 64px; margin-bottom: 16px; display: block; color: var(--dark-grey);"></i>
        <p style="font-size: 18px; margin-bottom: 8px;">Aucun dispositif IoT</p>
        <p style="font-size: 14px; margin-bottom: 24px;">Ajoutez des dispositifs pour commencer à gérer votre maison connectée.</p>
        {% if user.role == 'admin' %}
        <a href="{% url 'ajouter_dispositif' %}" style="padding: 12px 24px; background: var(--success); color: var(--light); border-radius: 8px; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; font-weight: 500;">
            <i class='bx bx-plus-circle'></i>Ajouter un dispositif
        </a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}

