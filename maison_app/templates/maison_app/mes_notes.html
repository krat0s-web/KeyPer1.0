{% extends "maison_app/base.html" %}
{% block title %}Mes Notes{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="text-primary fw-bold mb-0">Mes notes</h1>
        <button class="btn btn-light rounded-pill px-4" data-bs-toggle="modal" data-bs-target="#ajouterNoteModal">
            <i class="bi bi-plus me-2"></i>Nouvelle note +
        </button>
    </div>

    <!-- NOTES GRID -->
    <div class="row g-4">
        {% for note in notes %}
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm position-relative" style="background-color: #ffeb99; border: none;">
                <div class="position-absolute top-0 end-0 mt-2 me-2">
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-sm btn-dark rounded-circle" data-bs-toggle="modal" 
                                data-bs-target="#editerNoteModal{{ note.id }}" title="Éditer">
                            <i class="bi bi-three-dots"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <h5 class="card-title fw-bold">{{ note.titre }}</h5>
                    <p class="card-text" style="white-space: pre-wrap; word-wrap: break-word;">{{ note.contenu }}</p>
                    <small class="text-muted">{{ note.date_modification|date:"d/m/Y H:i" }}</small>
                </div>
            </div>
        </div>

        <!-- MODAL ÉDITION -->
        <div class="modal fade" id="editerNoteModal{{ note.id }}" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Éditer la note</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <form method="post">
                        {% csrf_token %}
                        <div class="modal-body">
                            <div class="mb-3">
                                <label class="form-label">Titre</label>
                                <input type="text" name="titre" class="form-control" value="{{ note.titre }}" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Contenu</label>
                                <textarea name="contenu" class="form-control" rows="5" required>{{ note.contenu }}</textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" name="modifier" class="btn btn-primary">Modifier</button>
                            <button type="submit" name="supprimer" class="btn btn-danger" 
                                    onclick="return confirm('Supprimer cette note ?');">Supprimer</button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                        </div>
                        <input type="hidden" name="note_id" value="{{ note.id }}">
                    </form>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12">
            <p class="text-center text-muted py-5">Aucune note. Créez-en une !</p>
        </div>
        {% endfor %}
    </div>
</div>

<!-- MODAL AJOUTER NOTE -->
<div class="modal fade" id="ajouterNoteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Nouvelle note</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="post">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Titre</label>
                        <input type="text" name="titre" class="form-control" placeholder="Ex: Allergies d'Arthur" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Contenu</label>
                        <textarea name="contenu" class="form-control" rows="5" placeholder="Écrivez votre note..." required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" name="ajouter" class="btn btn-primary">Créer</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    .card {
        border-radius: 16px;
        transition: transform 0.3s ease;
    }
    .card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 24px rgba(0,0,0,0.15) !important;
    }
</style>
{% endblock %}
