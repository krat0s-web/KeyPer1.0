{% extends "maison_app/dashboard_base.html" %}
{% load static %}
{% block title %}Mes R√©compenses et Troph√©es{% endblock %}
{% block page_title %}Mes R√©compenses et Troph√©es{% endblock %}
{% block page_heading %}R√©compenses{% endblock %}

{% block breadcrumb %}
                    <ul class="breadcrumb">
                        <li><a href="{% url 'dashboard' %}">Dashboard</a></li>
                        /
                        <li><a href="#" class="active">R√©compenses</a></li>
                    </ul>
{% endblock %}

{% block page_content %}
            <!-- Points Header -->
<div class="card-dashboard" style="background: linear-gradient(135deg, var(--primary), var(--light-primary)); color: var(--light); border: 2px solid var(--warning); text-align: center; padding: 48px; margin-bottom: 24px;">
    <h1 style="margin: 0 0 16px 0; font-size: 48px; display: flex; align-items: center; justify-content: center; gap: 16px;">
        <i class='bx bx-star' style="color: var(--warning);"></i><span style="color: var(--light) !important;">{{ total_points }} points</span>
                </h1>
    <p style="margin: 0; color: rgba(255,255,255,0.9); font-size: 18px;">Points accumul√©s en accomplissant des t√¢ches</p>
            </div>

            <!-- Troph√©es D√©bloqu√©s -->
<div style="margin-bottom: 32px;">
    <h3 style="font-size: 24px; font-weight: 600; color: var(--dark); margin-bottom: 24px; display: flex; align-items: center; gap: 12px;">
        <i class='bx bx-trophy' style="color: var(--warning);"></i>Troph√©es D√©bloqu√©s ({{ trophees.count }})
    </h3>
                {% if trophees %}
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 24px;">
                    {% for trophee in trophees %}
        <div class="card-dashboard" style="text-align: center; border: 2px solid var(--warning); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 16px rgba(255, 193, 7, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'">
            <div style="font-size: 4rem; margin-bottom: 16px;">
                            {% if trophee.type == 'premier' %}
                                üèÖ
                            {% elif trophee.type == '10' %}
                                ü•à
                            {% elif trophee.type == '50' %}
                                ü•á
                            {% elif trophee.type == '100' %}
                                üëë
                            {% elif trophee.type == 'streak' %}
                                üî•
                            {% elif trophee.type == 'rapide' %}
                                ‚ö°
                            {% elif trophee.type == 'social' %}
                                ü§ù
                            {% else %}
                                ‚≠ê
                            {% endif %}
                        </div>
            <h5 style="font-size: 20px; font-weight: 600; color: var(--warning); margin-bottom: 12px;">{{ trophee.nom }}</h5>
            <p style="color: var(--dark-grey); font-size: 14px; margin-bottom: 12px;">{{ trophee.description }}</p>
            <small style="color: var(--dark-grey); font-size: 12px; display: flex; align-items: center; justify-content: center; gap: 4px;">
                <i class='bx bx-calendar'></i>{{ trophee.date_obtention|date:"d/m/Y" }}
                        </small>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
    <div class="card-dashboard" style="text-align: center; padding: 48px;">
        <i class='bx bx-info-circle' style="font-size: 3rem; margin-bottom: 16px; display: block; color: var(--dark-grey);"></i>
        <p style="margin: 0; color: var(--dark-grey);">Compl√©tez des t√¢ches pour d√©bloquer vos premiers troph√©es !</p>
                </div>
                {% endif %}
            </div>

            <!-- Troph√©es Non D√©bloqu√©s -->
            {% if trophees_non_debloques %}
            <div style="margin-bottom: 32px;">
                <h3 style="font-size: 24px; font-weight: 600; color: var(--dark); margin-bottom: 24px; display: flex; align-items: center; gap: 12px;">
                    <i class='bx bx-lock' style="color: var(--dark-grey);"></i>Troph√©es √† D√©bloquer ({{ trophees_non_debloques|length }})
                </h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 24px;">
                    {% for trophee in trophees_non_debloques %}
                    <div class="card-dashboard" style="
                        text-align: center; 
                        border: 2px solid var(--dark-grey); 
                        opacity: 0.6; 
                        filter: grayscale(100%);
                        position: relative;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.15)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                        <div style="position: absolute; top: 12px; right: 12px; background: var(--danger); color: #FFFFFF; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                            üîí Verrouill√©
                        </div>
                        <div style="font-size: 4rem; margin-bottom: 16px; margin-top: 16px;">
                            {% if trophee.type == 'premier' %}
                                üèÖ
                            {% elif trophee.type == '10' %}
                                ü•à
                            {% elif trophee.type == '50' %}
                                ü•á
                            {% elif trophee.type == '100' %}
                                üëë
                            {% elif trophee.type == '200' %}
                                üíé
                            {% elif trophee.type == '500' %}
                                üåü
                            {% elif trophee.type == '1000' %}
                                üèÜ
                            {% elif trophee.type == 'streak' or trophee.type == 'streak_30' or trophee.type == 'streak_100' %}
                                üî•
                            {% elif trophee.type == 'rapide' or trophee.type == 'efficace' %}
                                ‚ö°
                            {% elif trophee.type == 'social' or trophee.type == 'collaborateur' %}
                                ü§ù
                            {% elif trophee.type == 'organise' %}
                                üìã
                            {% elif trophee.type == 'punctuel' %}
                                ‚è∞
                            {% elif trophee.type == 'budget_master' %}
                                üí∞
                            {% elif trophee.type == 'animal_lover' %}
                                üêæ
                            {% elif trophee.type == 'note_taker' %}
                                üìù
                            {% elif trophee.type == 'event_planner' %}
                                üìÖ
                            {% elif trophee.type == 'explorateur' %}
                                üó∫Ô∏è
                            {% else %}
                                ‚≠ê
                            {% endif %}
                        </div>
                        <h5 style="font-size: 20px; font-weight: 600; color: var(--dark-grey); margin-bottom: 12px;">{{ trophee.nom }}</h5>
                        <p style="color: var(--dark-grey); font-size: 14px; margin-bottom: 12px;">{{ trophee.description }}</p>
                        <small style="color: var(--dark-grey); font-size: 12px; display: flex; align-items: center; justify-content: center; gap: 4px;">
                            <i class='bx bx-lock'></i>Non d√©bloqu√©
                        </small>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- R√©compenses R√©centes -->
<div class="card-dashboard" style="border-left: 4px solid var(--success);">
    <h3 style="font-size: 24px; font-weight: 600; color: var(--dark); margin-bottom: 24px; display: flex; align-items: center; gap: 12px;">
        <i class='bx bx-gift' style="color: var(--success);"></i>R√©compenses R√©centes
    </h3>
                {% if recompenses %}
    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                <tr style="background: var(--grey); border-bottom: 2px solid var(--grey);">
                    <th style="padding: 16px; text-align: left; font-weight: 600; color: var(--dark);">R√©compense</th>
                    <th style="padding: 16px; text-align: left; font-weight: 600; color: var(--dark);">Points</th>
                    <th style="padding: 16px; text-align: left; font-weight: 600; color: var(--dark);">Type</th>
                    <th style="padding: 16px; text-align: left; font-weight: 600; color: var(--dark);">Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for recompense in recompenses|dictsort:"-date_obtention" %}
                <tr style="border-bottom: 1px solid var(--grey); transition: all 0.3s ease;" onmouseover="this.style.background='var(--grey)'" onmouseout="this.style.background='transparent'">
                    <td style="padding: 16px; color: var(--dark); display: flex; align-items: center; gap: 8px;">
                        <i class='bx bx-{{ recompense.icone }}' style="font-size: 20px; color: var(--primary);"></i>
                                {{ recompense.nom }}
                            </td>
                    <td style="padding: 16px;">
                        <span style="padding: 6px 12px; border-radius: 20px; font-weight: 500; font-size: 12px; background: var(--success); color: var(--light);">
                            +{{ recompense.points }} pts
                        </span>
                            </td>
                    <td style="padding: 16px;">
                                {% if recompense.type == 'points' %}
                            <span style="padding: 6px 12px; border-radius: 20px; font-weight: 500; font-size: 12px; background: var(--primary); color: var(--light);">Points</span>
                                {% elif recompense.type == 'badge' %}
                            <span style="padding: 6px 12px; border-radius: 20px; font-weight: 500; font-size: 12px; background: var(--dark-grey); color: var(--light);">Badge</span>
                                {% elif recompense.type == 'trophy' %}
                            <span style="padding: 6px 12px; border-radius: 20px; font-weight: 500; font-size: 12px; background: var(--warning); color: var(--dark);">Troph√©e</span>
                                {% else %}
                            <span style="padding: 6px 12px; border-radius: 20px; font-weight: 500; font-size: 12px; background: var(--dark-grey); color: var(--light);">R√©compense</span>
                                {% endif %}
                            </td>
                    <td style="padding: 16px; color: var(--dark-grey);">
                        <small>{{ recompense.date_obtention|date:"d/m/Y H:i" }}</small>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
    </div>
                {% else %}
    <div style="text-align: center; padding: 48px;">
        <i class='bx bx-exclamation-triangle' style="font-size: 3rem; margin-bottom: 16px; display: block; color: var(--dark-grey);"></i>
        <p style="margin: 0; color: var(--dark-grey);">Aucune r√©compense pour le moment. Compl√©tez une t√¢che pour en gagner !</p>
    </div>
    {% endif %}
</div>

<!-- Historique d√©taill√© des points -->
<div class="card-dashboard" style="margin-top: 32px; border-left: 4px solid var(--warning);">
    <h3 style="font-size: 24px; font-weight: 600; color: var(--dark); margin-bottom: 24px; display: flex; align-items: center; gap: 12px;">
        <i class='bx bx-history' style="color: var(--warning);"></i>Historique des Points (12 derniers mois)
    </h3>
    {% if historique_points %}
    <div style="display: flex; align-items: end; gap: 12px; height: 250px; padding: 20px; background: var(--grey); border-radius: 8px; margin-bottom: 24px;">
        {% for mois in historique_points %}
        <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 8px;">
            <div style="width: 100%; background: linear-gradient(to top, var(--warning), var(--success)); border-radius: 8px 8px 0 0; min-height: 20px; height: {% widthratio mois.points 100 200 %}px; max-height: 200px; transition: all 0.3s ease; position: relative;" title="{{ mois.nom_mois }}: {{ mois.points }} points ({{ mois.count }} r√©compense{{ mois.count|pluralize }})">
                {% if mois.points > 0 %}
                <div style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); background: var(--dark); color: var(--light); padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; white-space: nowrap;">
                    {{ mois.points }} pts
                </div>
                {% endif %}
            </div>
            <small style="color: var(--dark-grey); font-size: 11px; writing-mode: vertical-rl; text-orientation: mixed;">{{ mois.mois }}</small>
        </div>
        {% endfor %}
    </div>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
        {% for mois in historique_points %}
        {% if mois.points > 0 %}
        <div style="padding: 12px; background: var(--light-warning); border-radius: 8px;">
            <div style="font-weight: 600; color: var(--dark); margin-bottom: 4px;">{{ mois.nom_mois }}</div>
            <div style="color: var(--dark-grey); font-size: 14px;">{{ mois.points }} points</div>
            <div style="color: var(--dark-grey); font-size: 12px;">{{ mois.count }} r√©compense{{ mois.count|pluralize }}</div>
        </div>
        {% endif %}
        {% endfor %}
    </div>
    {% else %}
    <div style="text-align: center; padding: 48px;">
        <i class='bx bx-info-circle' style="font-size: 3rem; margin-bottom: 16px; display: block; color: var(--dark-grey);"></i>
        <p style="margin: 0; color: var(--dark-grey);">Aucun historique disponible</p>
    </div>
    {% endif %}
</div>

<!-- T√¢ches avec r√©compenses -->
{% if recompenses_avec_taches %}
<div class="card-dashboard" style="margin-top: 32px; border-left: 4px solid var(--success);">
    <h3 style="font-size: 24px; font-weight: 600; color: var(--dark); margin-bottom: 24px; display: flex; align-items: center; gap: 12px;">
        <i class='bx bx-check-circle' style="color: var(--success);"></i>T√¢ches Compl√©t√©es avec R√©compenses
    </h3>
    <div style="display: flex; flex-direction: column; gap: 12px;">
        {% for recompense in recompenses_avec_taches %}
        {% if recompense.id_tache %}
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px; background: var(--light-success); border-radius: 8px;">
            <div>
                <strong style="color: var(--dark);">{{ recompense.id_tache.titre }}</strong>
                <div style="color: var(--dark-grey); font-size: 14px; margin-top: 4px;">
                    Compl√©t√©e le {{ recompense.date_obtention|date:"d/m/Y H:i" }}
                </div>
            </div>
            <div style="padding: 8px 16px; background: var(--success); color: var(--light); border-radius: 20px; font-weight: 600;">
                +{{ recompense.points }} pts
            </div>
        </div>
        {% endif %}
        {% endfor %}
    </div>
</div>
{% endif %}
{% endblock %}
