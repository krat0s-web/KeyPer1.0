{% extends "maison_app/dashboard_base.html" %}
{% load static %}
{% block title %}Mon Profil{% endblock %}
{% block page_title %}Mon Profil{% endblock %}
{% block page_heading %}Profil{% endblock %}

{% block breadcrumb %}
                    <ul class="breadcrumb">
                        <li><a href="{% url 'dashboard' %}">Dashboard</a></li>
                        /
                        <li><a href="#" class="active">Profil</a></li>
                    </ul>
{% endblock %}

{% block page_content %}
<div style="display: flex; gap: 24px; margin-bottom: 24px; flex-wrap: wrap;">
                <!-- Photo de profil √† gauche -->
    <div style="min-width: 200px;">
        <div style="position: relative; width: 200px; height: 200px; border-radius: 20px; overflow: hidden; background: var(--light); border: 3px solid var(--grey); display: flex; align-items: center; justify-content: center;">
                        {% if user.photo_profil %}
            <img src="{{ user.photo_profil.url }}" alt="Photo de profil" id="profile-photo-preview" style="width: 100%; height: 100%; object-fit: cover;">
                        {% else %}
            <div id="profile-photo-placeholder" style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: var(--grey);">
                            <i class='bx bx-user' style="font-size: 4rem; color: var(--dark-grey);"></i>
                        </div>
                        {% endif %}
                        <button onclick="document.getElementById('avatarModal').style.display='block'" style="position: absolute; bottom: 0; left: 0; right: 0; width: 100%; cursor: pointer; margin: 0; background: rgba(0, 0, 0, 0.7); color: white; padding: 12px; text-align: center; font-weight: 500; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px; border: none;" onmouseover="this.style.background='rgba(0,0,0,0.9)'" onmouseout="this.style.background='rgba(0,0,0,0.7)'">
                            <i class='bx bx-camera'></i>Modifier
                        </button>
                    </div>
                </div>

                <!-- Informations √† droite -->
    <div style="flex: 1; min-width: 300px;">
        <div class="card-dashboard">
            <h5 style="font-size: 20px; font-weight: 600; color: var(--dark); margin-bottom: 20px;">Mes informations</h5>
            <div style="margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid var(--grey);">
                <strong style="color: var(--dark); display: block; margin-bottom: 8px;">R√¥le{% if foyer_actuel %} dans {{ foyer_actuel.nom }}{% endif %} :</strong>
                    <span>
                        {% if role_dans_foyer_actif == 'admin' %}
                        <span style="padding: 6px 12px; border-radius: 20px; font-weight: 500; background: var(--danger); color: #FFFFFF !important;">Administrateur</span>
                        {% elif role_dans_foyer_actif == 'tresorier' %}
                        <span style="padding: 6px 12px; border-radius: 20px; font-weight: 500; background: var(--warning); color: #FFFFFF !important;">Tr√©sorier</span>
                        {% elif role_dans_foyer_actif == 'membre' %}
                        <span style="padding: 6px 12px; border-radius: 20px; font-weight: 500; background: var(--primary); color: #FFFFFF !important;">Membre</span>
                        {% elif role_dans_foyer_actif == 'junior' %}
                        <span style="padding: 6px 12px; border-radius: 20px; font-weight: 500; background: var(--success); color: #FFFFFF !important;">Junior</span>
                        {% elif role_dans_foyer_actif == 'observateur' %}
                        <span style="padding: 6px 12px; border-radius: 20px; font-weight: 500; background: var(--dark-grey); color: #FFFFFF !important;">Observateur</span>
                        {% elif role_dans_foyer_actif == 'invite' %}
                        <span style="padding: 6px 12px; border-radius: 20px; font-weight: 500; background: var(--grey); color: var(--dark);">Invit√©</span>
                        {% else %}
                        <span style="padding: 6px 12px; border-radius: 20px; font-weight: 500; background: var(--dark-grey); color: #FFFFFF !important;">{{ user.get_role_display }}</span>
                        {% endif %}
                    </span>
                </div>
            <div style="margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid var(--grey);">
                <strong style="color: var(--dark); display: block; margin-bottom: 8px;">Membre depuis :</strong>
                <span style="color: var(--dark-grey);">{{ user.date_joined|date:"d/m/Y" }}</span>
                </div>
            <div style="margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid var(--grey);">
                <strong style="color: var(--dark); display: block; margin-bottom: 8px;">Nom d'utilisateur :</strong>
                <span style="color: var(--dark-grey);">{{ user.nom|default:user.email }}</span>
                </div>
            <div style="margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid var(--grey);">
                <strong style="color: var(--dark); display: block; margin-bottom: 8px;">Email :</strong>
                <span style="color: var(--dark-grey);">{{ user.email }}</span>
                </div>
            <div style="margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid var(--grey);">
                <strong style="color: var(--dark); display: block; margin-bottom: 8px;">Foyer actuel :</strong>
                <span style="color: var(--dark-grey);">{{ foyer_actuel.nom|default:"‚Äî" }}</span>
                </div>
            <div style="margin-bottom: 0; display: flex; gap: 12px; flex-wrap: wrap;">
                {% load permission_tags %}
                {% if user|can:"can_manage_preferences" %}
                <a href="{% url 'mes_preferences' %}" style="padding: 12px 24px; background: var(--primary); color: var(--light); border-radius: 8px; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; font-weight: 500; transition: all 0.3s ease;">
                    <i class='bx bx-cog'></i>G√©rer mes pr√©f√©rences
                </a>
                {% endif %}
                {% if user|can:"can_view_stats" %}
                <a href="{% url 'mes_statistiques' %}" style="padding: 12px 24px; background: var(--success); color: var(--light); border-radius: 8px; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; font-weight: 500; transition: all 0.3s ease;">
                    <i class='bx bx-bar-chart-alt-2'></i>Mes statistiques
                </a>
                {% endif %}
                <button onclick="document.getElementById('changerMotDePasseModal').style.display='block'" style="padding: 12px 24px; background: var(--warning); color: var(--dark); border: none; border-radius: 8px; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; font-weight: 500; transition: all 0.3s ease;">
                    <i class='bx bx-lock-alt'></i>Changer le mot de passe
                </button>
            </div>
                    </div>
                </div>
            </div>

<div class="card-dashboard" style="border-left: 4px solid var(--primary);">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 12px;">
        <h5 style="font-size: 20px; font-weight: 600; color: var(--dark); margin: 0;">Mes foyers ({{ foyers.count }})</h5>
        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
            <a href="{% url 'creer_foyer' %}" style="padding: 8px 16px; border-radius: 20px; font-weight: 500; text-decoration: none; transition: all 0.3s ease; font-size: 14px; background: var(--success); color: white; display: flex; align-items: center; gap: 8px;">
                <i class='bx bx-plus'></i>Cr√©er un foyer
            </a>
            <a href="{% url 'rejoindre_foyer' %}" style="padding: 8px 16px; border-radius: 20px; font-weight: 500; text-decoration: none; transition: all 0.3s ease; font-size: 14px; background: var(--primary); color: white; display: flex; align-items: center; gap: 8px;">
                <i class='bx bx-log-in'></i>Rejoindre un foyer
            </a>
        </div>
    </div>
                {% if foyers.count > 0 %}
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 24px;">
                    {% for foyer in foyers %}
        <div class="card-dashboard" style="padding: 0; overflow: hidden; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.1)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'">
                        {% if foyer.photo %}
            <img src="{{ foyer.photo.url }}" alt="{{ foyer.nom }}" style="width: 100%; height: 180px; object-fit: cover;">
                        {% else %}
                        <div style="height: 180px; background: var(--grey); display: flex; align-items: center; justify-content: center;">
                            <i class='bx bx-home' style="font-size: 3rem; color: var(--dark-grey);"></i>
                        </div>
                        {% endif %}
            <div style="padding: 20px;">
                <h6 style="font-size: 18px; font-weight: 600; color: var(--dark); margin-bottom: 12px;">{{ foyer.nom }}</h6>
                <p style="color: var(--dark-grey); font-size: 14px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                                <i class='bx bx-group'></i>
                                {% if foyer.utilisateurs.count %}
                                    {{ foyer.utilisateurs.count }} membre{{ foyer.utilisateurs.count|pluralize }}
                                {% else %}
                                    Aucun membre
                                {% endif %}
                            </p>
                            {% if foyer.description %}
                <p style="font-size: 12px; color: var(--dark-grey); margin-bottom: 16px;">{{ foyer.description|truncatewords:10 }}</p>
                            {% endif %}
                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <form method="post" style="display: inline;">
                                    {% csrf_token %}
                                    <input type="hidden" name="foyer_id" value="{{ foyer.id }}">
                        <button type="submit" name="changer_foyer" style="padding: 8px 16px; border-radius: 20px; border: none; font-weight: 500; cursor: pointer; transition: all 0.3s ease; font-size: 14px; display: inline-flex; align-items: center; gap: 4px;
                            {% if foyer_actuel and foyer.id == foyer_actuel.id %}background: var(--success); color: white;
                            {% else %}background: transparent; color: var(--dark); border: 1px solid var(--dark);{% endif %}">
                                        {% if foyer_actuel and foyer.id == foyer_actuel.id %}
                                <i class='bx bx-check-circle'></i>Actif
                                        {% else %}
                                <i class='bx bx-right-arrow-circle'></i>S√©lectionner
                                        {% endif %}
                                    </button>
                                </form>
                    <a href="{% url 'detail_foyer' foyer.id %}" style="padding: 8px 16px; border-radius: 20px; font-weight: 500; text-decoration: none; transition: all 0.3s ease; font-size: 14px; background: transparent; color: var(--primary); border: 1px solid var(--primary); display: inline-flex; align-items: center; gap: 4px;">
                        <i class='bx bx-show'></i>D√©tails
                    </a>
                    {% if foyer.cree_par == user %}
                    <a href="{% url 'modifier_foyer' foyer.id %}" style="padding: 8px 16px; border-radius: 20px; font-weight: 500; text-decoration: none; transition: all 0.3s ease; font-size: 14px; background: var(--warning); color: var(--dark); display: inline-flex; align-items: center; gap: 4px;">
                        <i class='bx bx-edit'></i>Modifier
                    </a>
                    {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
    <div style="text-align: center; padding: 48px;">
        <i class='bx bx-home' style="font-size: 4rem; margin-bottom: 16px; display: block; color: var(--dark-grey);"></i>
        <p style="margin: 0 0 24px 0; color: var(--dark-grey);">
            Vous n'appartenez √† aucun foyer. Cr√©ez-en un ou rejoignez-en un avec un code d'invitation !
        </p>
        <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
            <button style="padding: 12px 24px; border-radius: 36px; border: none; font-weight: 500; cursor: pointer; transition: all 0.3s ease; font-size: 14px; background: var(--success); color: white; display: inline-flex; align-items: center; gap: 8px;" data-bs-toggle="modal" data-bs-target="#creerFoyerModal">
                <i class='bx bx-plus-circle'></i>Cr√©er un foyer
            </button>
            <a href="{% url 'rejoindre_foyer' %}" style="padding: 12px 24px; border-radius: 36px; font-weight: 500; text-decoration: none; transition: all 0.3s ease; font-size: 14px; background: var(--primary); color: white; display: inline-flex; align-items: center; gap: 8px;">
                <i class='bx bx-log-in'></i>Rejoindre un foyer
            </a>
        </div>
    </div>
                {% endif %}
            </div>

<div class="card-dashboard" style="text-align: center; border-left: 4px solid var(--danger);">
    <h5 style="font-size: 20px; font-weight: 600; color: var(--dark); margin-bottom: 16px;">D√©connexion</h5>
                <p style="color: var(--dark-grey); margin-bottom: 24px;">Souhaitez-vous vous d√©connecter ?</p>
    <a href="{% url 'logout' %}" style="padding: 12px 24px; border-radius: 36px; border: none; font-weight: 500; cursor: pointer; text-decoration: none; transition: all 0.3s ease; background: var(--dark); color: var(--light); display: inline-flex; align-items: center; gap: 8px;" onclick="return confirm('√ätes-vous s√ªr de vouloir vous d√©connecter ?')">
                    Me d√©connecter
                </a>
</div>

<!-- MODAL CR√âER FOYER (Tous les utilisateurs) -->
<div class="modal fade" id="creerFoyerModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="background: var(--success); color: white;">
                <h5 class="modal-title" style="display: flex; align-items: center; gap: 8px;">
                    <i class='bx bx-home'></i>Cr√©er un nouveau foyer
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="modal-body">
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; color: var(--dark); font-weight: 500;">Nom du foyer <span style="color: var(--danger);">*</span></label>
                        <input type="text" name="nom" style="width: 100%; padding: 12px; border: 1px solid var(--grey); border-radius: 8px; background: var(--light); color: var(--dark); outline: none;" placeholder="Ex: Maison Dupont" required>
                        <small style="color: var(--dark-grey); font-size: 12px;">Le nom doit √™tre unique et descriptif</small>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; color: var(--dark); font-weight: 500;">Description</label>
                        <textarea name="description" rows="3" style="width: 100%; padding: 12px; border: 1px solid var(--grey); border-radius: 8px; background: var(--light); color: var(--dark); outline: none; resize: vertical;" placeholder="Description du foyer (optionnel)"></textarea>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; color: var(--dark); font-weight: 500;">üì∑ Photo du foyer (optionnel)</label>
                        <input type="file" name="photo" style="width: 100%; padding: 12px; border: 1px solid var(--grey); border-radius: 8px; background: var(--light); color: var(--dark); outline: none;" accept="image/*">
                        <small style="color: var(--dark-grey); font-size: 12px;">JPG, PNG (max 5MB)</small>
                    </div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid var(--grey); padding: 16px; display: flex; gap: 8px; justify-content: flex-end;">
                    <button type="submit" name="creer_foyer" style="padding: 8px 16px; border-radius: 20px; border: none; font-weight: 500; cursor: pointer; transition: all 0.3s ease; font-size: 14px; background: var(--success); color: white; display: flex; align-items: center; gap: 8px;">
                        <i class='bx bx-check-circle'></i>Cr√©er le foyer
                    </button>
                    <button type="button" style="padding: 8px 16px; border-radius: 20px; border: 1px solid var(--dark); font-weight: 500; cursor: pointer; transition: all 0.3s ease; font-size: 14px; background: transparent; color: var(--dark);" data-bs-dismiss="modal">Annuler</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- MODAL S√âLECTION AVATAR -->
<div id="avatarModal" style="display: none; position: fixed; z-index: 3000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); overflow-y: auto;">
    <div style="background: var(--light); margin: 5% auto; padding: 0; border-radius: 16px; width: 90%; max-width: 800px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
        <div style="padding: 24px; border-bottom: 1px solid var(--grey); display: flex; justify-content: space-between; align-items: center; background: linear-gradient(135deg, var(--primary), var(--light-primary)); border-radius: 16px 16px 0 0;">
            <h5 style="margin: 0; color: #FFFFFF !important; display: flex; align-items: center; gap: 8px;">
                <i class='bx bx-image' style="color: #FFFFFF;"></i>Choisir votre photo de profil
            </h5>
            <button onclick="document.getElementById('avatarModal').style.display='none'" style="background: none; border: none; font-size: 28px; cursor: pointer; color: #FFFFFF; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">&times;</button>
        </div>
        <div style="padding: 24px;">
            <!-- Onglets -->
            <div style="display: flex; gap: 8px; margin-bottom: 24px; border-bottom: 2px solid var(--grey);">
                <button onclick="showTab('avatars')" id="tab-avatars" style="padding: 12px 24px; background: var(--primary); color: var(--light); border: none; border-radius: 8px 8px 0 0; cursor: pointer; font-weight: 500; transition: all 0.3s ease;">
                    <i class='bx bx-grid-alt'></i> Avatars
                </button>
                <button onclick="showTab('upload')" id="tab-upload" style="padding: 12px 24px; background: transparent; color: var(--dark); border: none; border-radius: 8px 8px 0 0; cursor: pointer; font-weight: 500; transition: all 0.3s ease;">
                    <i class='bx bx-upload'></i> Importer une image
                </button>
            </div>

            <!-- Contenu Avatars -->
            <div id="content-avatars" style="display: block;">
                <p style="color: var(--dark-grey); margin-bottom: 16px;">Choisissez un avatar parmi la galerie :</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 16px; max-height: 400px; overflow-y: auto; padding: 8px;">
                    {% for avatar in avatars %}
                        <form method="post" enctype="multipart/form-data" style="display: inline;">
                            {% csrf_token %}
                            <input type="hidden" name="avatar_selection" value="{{ avatar }}">
                            <button type="submit" style="width: 100%; aspect-ratio: 1; border: 3px solid var(--grey); border-radius: 12px; overflow: hidden; cursor: pointer; padding: 0; background: var(--light); transition: all 0.3s ease;" onmouseover="this.style.borderColor='var(--primary)'; this.style.transform='scale(1.05)'" onmouseout="this.style.borderColor='var(--grey)'; this.style.transform='scale(1)'">
                                <img src="{% static 'images/' %}{{ avatar }}" alt="Avatar {{ forloop.counter }}" style="width: 100%; height: 100%; object-fit: cover;">
                            </button>
                        </form>
                    {% endfor %}
                </div>
            </div>

            <!-- Contenu Upload -->
            <div id="content-upload" style="display: none;">
                <p style="color: var(--dark-grey); margin-bottom: 16px;">Importez une image depuis votre appareil :</p>
                <form method="post" enctype="multipart/form-data" id="upload-form">
                    {% csrf_token %}
                    <input type="file" name="photo_profil" id="photo-input" accept="image/*" style="display: none;" onchange="previewUploadedImage(this)">
                    <input type="hidden" name="modifier_photo" value="1">
                    <div style="border: 2px dashed var(--grey); border-radius: 12px; padding: 32px; text-align: center; margin-bottom: 16px; cursor: pointer;" onclick="document.getElementById('photo-input').click()" onmouseover="this.style.borderColor='var(--primary)'" onmouseout="this.style.borderColor='var(--grey)'">
                        <i class='bx bx-cloud-upload' style="font-size: 3rem; color: var(--primary); margin-bottom: 16px; display: block;"></i>
                        <p style="color: var(--dark); font-weight: 500; margin: 0 0 8px 0;">Cliquez pour s√©lectionner une image</p>
                        <p style="color: var(--dark-grey); font-size: 12px; margin: 0;">JPG, PNG (max 5MB)</p>
                    </div>
                    <div id="upload-preview" style="display: none; margin-bottom: 16px;">
                        <img id="upload-preview-img" src="" alt="Aper√ßu" style="width: 100%; max-height: 300px; object-fit: contain; border-radius: 8px; border: 2px solid var(--grey);">
                    </div>
                    <div style="display: flex; gap: 12px; justify-content: flex-end;">
                        <button type="button" onclick="document.getElementById('avatarModal').style.display='none'" style="padding: 12px 24px; background: var(--grey); color: var(--dark); border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">
                            Annuler
                        </button>
                        <button type="submit" id="upload-submit" style="padding: 12px 24px; background: var(--primary); color: var(--light); border: none; border-radius: 8px; cursor: pointer; font-weight: 500; display: none;">
                            <i class='bx bx-check'></i> Enregistrer
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
// Gestion des onglets
function showTab(tab) {
    const avatarsContent = document.getElementById('content-avatars');
    const uploadContent = document.getElementById('content-upload');
    const avatarsTab = document.getElementById('tab-avatars');
    const uploadTab = document.getElementById('tab-upload');
    
    if (tab === 'avatars') {
        avatarsContent.style.display = 'block';
        uploadContent.style.display = 'none';
        avatarsTab.style.background = 'var(--primary)';
        avatarsTab.style.color = 'var(--light)';
        uploadTab.style.background = 'transparent';
        uploadTab.style.color = 'var(--dark)';
    } else {
        avatarsContent.style.display = 'none';
        uploadContent.style.display = 'block';
        uploadTab.style.background = 'var(--primary)';
        uploadTab.style.color = 'var(--light)';
        avatarsTab.style.background = 'transparent';
        avatarsTab.style.color = 'var(--dark)';
    }
}


// Pr√©visualisation de l'image upload√©e
function previewUploadedImage(input) {
    if (input.files && input.files[0]) {
        // V√©rifier la taille (max 5MB)
        if (input.files[0].size > 5 * 1024 * 1024) {
            alert('La photo est trop volumineuse (max 5MB).');
            input.value = '';
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(event) {
            const preview = document.getElementById('upload-preview');
            const previewImg = document.getElementById('upload-preview-img');
            const submitBtn = document.getElementById('upload-submit');
            
            previewImg.src = event.target.result;
            preview.style.display = 'block';
            submitBtn.style.display = 'inline-flex';
        };
        reader.readAsDataURL(input.files[0]);
    }
}

// Fermer la modal en cliquant √† l'ext√©rieur
window.onclick = function(event) {
    const modal = document.getElementById('avatarModal');
    if (event.target == modal) {
        modal.style.display = 'none';
    }
    const modalPwd = document.getElementById('changerMotDePasseModal');
    if (event.target == modalPwd) {
        modalPwd.style.display = 'none';
    }
}
</script>

<!-- Modal Changer Mot de Passe -->
<div id="changerMotDePasseModal" style="display: none; position: fixed; z-index: 3000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5);">
    <div style="background: var(--light); margin: 5% auto; padding: 0; border-radius: 16px; width: 90%; max-width: 500px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
        <div style="padding: 24px; border-bottom: 1px solid var(--grey); display: flex; justify-content: space-between; align-items: center;">
            <h5 style="margin: 0; color: var(--dark); display: flex; align-items: center; gap: 8px;">
                <i class='bx bx-lock-alt' style="color: var(--primary);"></i>Changer le mot de passe
            </h5>
            <button onclick="document.getElementById('changerMotDePasseModal').style.display='none'" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--dark);">&times;</button>
        </div>
        <form method="post" style="padding: 24px;">
            {% csrf_token %}
            <input type="hidden" name="changer_mot_de_passe" value="1">
            <div style="margin-bottom: 16px;">
                <label style="display: block; margin-bottom: 8px; color: var(--dark); font-weight: 600;">Ancien mot de passe</label>
                <input type="password" name="ancien_mot_de_passe" required style="width: 100%; padding: 12px; border: 2px solid var(--grey); border-radius: 8px; font-size: 14px;">
            </div>
            <div style="margin-bottom: 16px;">
                <label style="display: block; margin-bottom: 8px; color: var(--dark); font-weight: 600;">Nouveau mot de passe</label>
                <input type="password" name="nouveau_mot_de_passe" required minlength="8" style="width: 100%; padding: 12px; border: 2px solid var(--grey); border-radius: 8px; font-size: 14px;">
                <small style="color: var(--dark-grey);">Minimum 8 caract√®res</small>
            </div>
            <div style="margin-bottom: 24px;">
                <label style="display: block; margin-bottom: 8px; color: var(--dark); font-weight: 600;">Confirmer le nouveau mot de passe</label>
                <input type="password" name="confirmer_mot_de_passe" required minlength="8" style="width: 100%; padding: 12px; border: 2px solid var(--grey); border-radius: 8px; font-size: 14px;">
            </div>
            <div style="display: flex; gap: 12px; justify-content: flex-end;">
                <button type="button" onclick="document.getElementById('changerMotDePasseModal').style.display='none'" style="padding: 12px 24px; background: var(--grey); color: var(--dark); border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">Annuler</button>
                <button type="submit" style="padding: 12px 24px; background: var(--primary); color: var(--light); border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">Changer</button>
            </div>
        </form>
    </div>
</div>

<!-- Section Pr√©f√©rences (√† venir) -->
<div class="card-dashboard" style="margin-top: 24px; border-left: 4px solid var(--success); opacity: 0.7;">
    <h5 style="font-size: 20px; font-weight: 600; color: var(--dark); margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
        <i class='bx bx-cog' style="color: var(--success);"></i>Mes Pr√©f√©rences
    </h5>
    <p style="color: var(--dark-grey);">Les pr√©f√©rences utilisateur seront disponibles prochainement.</p>
</div>
{% endblock %}
