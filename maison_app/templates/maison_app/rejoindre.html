{% extends "maison_app/dashboard_base.html" %}
{% load static %}
{% load permission_tags %}
{% block title %}Rejoindre un Foyer{% endblock %}
{% block page_title %}Rejoindre un Foyer{% endblock %}
{% block page_heading %}Rejoindre un Foyer{% endblock %}

{% block breadcrumb %}
<ul class="breadcrumb">
    <li><a href="{% url 'dashboard' %}">Dashboard</a></li>
    /
    <li><a href="{% url 'liste_foyers' %}">Foyers</a></li>
    /
    <li><a href="#" class="active">Rejoindre</a></li>
</ul>
{% endblock %}

{% block page_content %}
<div class="card-dashboard">
    <div style="max-width: 600px; margin: 0 auto;">
        <div style="text-align: center; margin-bottom: 32px;">
            <i class='bx bx-log-in' style="font-size: 48px; color: var(--primary); margin-bottom: 16px;"></i>
            <h2 style="color: var(--dark); margin-bottom: 8px;">Rejoindre un Foyer</h2>
            <p style="color: var(--dark-grey);">Entrez le code d'invitation pour rejoindre un foyer</p>
        </div>
        
        {% if user.is_authenticated %}
        <div style="background: var(--light-primary); border-left: 4px solid var(--primary); padding: 16px; border-radius: 8px; margin-bottom: 24px;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <i class='bx bx-info-circle' style="font-size: 24px; color: var(--primary);"></i>
                <div>
                    <strong style="color: var(--dark);">Connecté en tant que</strong>
                    <p style="margin: 4px 0 0 0; color: var(--dark-grey);">{{ user.email }}</p>
                </div>
            </div>
        </div>
        {% endif %}
        
        <form method="post">
            {% csrf_token %}
            <div style="margin-bottom: 24px;">
                <label style="display: block; margin-bottom: 8px; color: var(--dark); font-weight: 500;">
                    <i class='bx bx-key' style="margin-right: 8px;"></i>Code d'invitation
                </label>
                <input type="text" name="code" class="form-control" 
                       placeholder="Ex: b9e61bff-d34f-4d90-9236-fca9e61b9e61" 
                       value="{% if code_prefill %}{{ code_prefill }}{% endif %}" 
                       required
                       style="width: 100%; padding: 12px 16px; border: 2px solid var(--grey); border-radius: 8px; font-size: 14px; transition: all 0.3s ease;"
                       onfocus="this.style.borderColor='var(--primary)'; this.style.outline='none';"
                       onblur="this.style.borderColor='var(--grey)';">
            </div>
            
            <!-- AFFICHE SEULEMENT SI NON CONNECTÉ -->
            {% if not user.is_authenticated %}
            <div style="margin-bottom: 24px;">
                <label style="display: block; margin-bottom: 8px; color: var(--dark); font-weight: 500;">
                    <i class='bx bx-user' style="margin-right: 8px;"></i>Votre nom
                </label>
                <input type="text" name="nom" class="form-control" placeholder="Jean Dupont" required
                       style="width: 100%; padding: 12px 16px; border: 2px solid var(--grey); border-radius: 8px; font-size: 14px; transition: all 0.3s ease;"
                       onfocus="this.style.borderColor='var(--primary)'; this.style.outline='none';"
                       onblur="this.style.borderColor='var(--grey)';">
            </div>
            <div style="margin-bottom: 24px;">
                <label style="display: block; margin-bottom: 8px; color: var(--dark); font-weight: 500;">
                    <i class='bx bx-envelope' style="margin-right: 8px;"></i>Votre email
                </label>
                <input type="email" name="email" class="form-control" placeholder="jean@exemple.com" required
                       style="width: 100%; padding: 12px 16px; border: 2px solid var(--grey); border-radius: 8px; font-size: 14px; transition: all 0.3s ease;"
                       onfocus="this.style.borderColor='var(--primary)'; this.style.outline='none';"
                       onblur="this.style.borderColor='var(--grey)';">
            </div>
            {% endif %}
            
            <button type="submit" 
                    style="width: 100%; padding: 14px 24px; background: var(--primary); color: var(--light); border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px;"
                    onmouseover="this.style.background='var(--primary-dark)'; this.style.transform='translateY(-2px)';"
                    onmouseout="this.style.background='var(--primary)'; this.style.transform='translateY(0)';">
                <i class='bx bx-log-in'></i>Rejoindre le foyer
            </button>
        </form>
        
        <div style="text-align: center; margin-top: 24px;">
            <a href="{% url 'liste_foyers' %}" style="color: var(--primary); text-decoration: none; font-size: 14px;">
                <i class='bx bx-arrow-back'></i> Retour aux foyers
            </a>
        </div>
    </div>
</div>
{% endblock %}