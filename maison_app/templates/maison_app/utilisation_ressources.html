{% extends "maison_app/dashboard_base.html" %}
{% load static %}
{% block title %}Utilisation des Ressources{% endblock %}
{% block page_title %}Utilisation des Ressources{% endblock %}
{% block page_heading %}Utilisation des Ressources{% endblock %}

{% block breadcrumb %}
<ul class="breadcrumb">
    <li><a href="{% url 'dashboard' %}">Dashboard</a></li>
    /
    <li><a href="{% url 'detail_foyer' foyer.id %}">Foyer</a></li>
    /
    <li><a href="#" class="active">Utilisation Ressources</a></li>
</ul>
{% endblock %}

{% block page_content %}
<div class="card-dashboard mb-4">
    <h3 style="color: var(--dark); display: flex; align-items: center; gap: 12px; margin-bottom: 24px;">
        <i class='bx bx-package' style="font-size: 28px; color: var(--primary);"></i>Utilisation des Ressources
    </h3>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
        <div style="background: var(--light-primary); padding: 16px; border-radius: 8px; border-left: 4px solid var(--primary);">
            <p style="margin: 0; font-size: 24px; font-weight: 700; color: var(--dark);">{{ total_utilisations }}</p>
            <p style="margin: 4px 0 0 0; color: var(--dark-grey); font-size: 14px;">Utilisations totales</p>
        </div>
    </div>
    
    {% if utilisations %}
    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: var(--grey);">
                    <th style="padding: 12px; text-align: left; color: var(--dark); font-weight: 600; border-bottom: 2px solid var(--grey);">Date</th>
                    <th style="padding: 12px; text-align: left; color: var(--dark); font-weight: 600; border-bottom: 2px solid var(--grey);">Ressource</th>
                    <th style="padding: 12px; text-align: center; color: var(--dark); font-weight: 600; border-bottom: 2px solid var(--grey);">Quantité utilisée</th>
                    <th style="padding: 12px; text-align: left; color: var(--dark); font-weight: 600; border-bottom: 2px solid var(--grey);">Tâche</th>
                </tr>
            </thead>
            <tbody>
                {% for utilisation in utilisations %}
                <tr style="border-bottom: 1px solid var(--grey);">
                    <td style="padding: 12px; color: var(--dark);">{{ utilisation.date_utilisation|date:"d/m/Y H:i" }}</td>
                    <td style="padding: 12px; color: var(--dark); font-weight: 500;">{{ utilisation.id_inventaire.nom }}</td>
                    <td style="padding: 12px; text-align: center; color: var(--dark);">
                        {{ utilisation.quantite_utilisee }} {{ utilisation.id_inventaire.unite|default:"" }}
                    </td>
                    <td style="padding: 12px; color: var(--dark-grey);">
                        {% if utilisation.id_tache %}
                        <a href="{% url 'detail_tache' utilisation.id_tache.id %}" style="color: var(--primary); text-decoration: none;">{{ utilisation.id_tache.titre }}</a>
                        {% else %}
                        —
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div style="text-align: center; padding: 48px; color: var(--dark-grey);">
        <i class='bx bx-package' style="font-size: 48px; margin-bottom: 16px; display: block;"></i>
        <p>Aucune utilisation de ressource enregistrée pour le moment.</p>
    </div>
    {% endif %}
</div>
{% endblock %}

